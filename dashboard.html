<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>GoathBet Dashboard</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/yYzNXKqx/Picsart-25-10-27-10-15-31-195.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

<script>
    const API_BASE = "https://keysdash.espanhaserrita.workers.dev/";

    async function verificarSessao() {
      const token = sessionStorage.getItem("sessionId");
      if (!token) {
        window.location.href = "/";
        return;
      }

      try {
        const res = await fetch(API_BASE + "verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token }),
        });
        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          window.location.href = "/";
        }
      } catch (err) {
        console.error("Erro ao validar sessão:", err);
        window.location.href = "/";
      }
    }

    verificarSessao();
  </script>
    <link rel="stylesheet" href="style.css"/>

    <style>
        .logout-button{
            background-color:#dc3545;color:white;border:none;padding:5px 10px;border-radius:4px;
            cursor:pointer;font-weight:500;font-size:0.8rem;transition:background-color .2s;margin-top:5px;
        }
        .logout-button:hover{background-color:#c82333;}

        .header{display:flex;justify-content:space-between;align-items:flex-start;}
        .header-left-content{display:flex;flex-direction:column;align-items:flex-start;}

        /* CARD SLIM 100x – RADAR VERMELHO CENTRAL */
        .alerta-100x-card{
            position:relative;width:100%;height:36px;display:flex;align-items:center;
            justify-content:center;background-color:#1a1a1a !important;color:#ffffff !important;
            font-size:14px;font-weight:600;overflow:hidden;cursor:pointer;border-radius:8px;
            margin-bottom:15px;z-index:1000;padding:0 12px;
        }
        .alerta-100x-card.alerta-ativo{
            background-color:#e7c84b !important;color:#1a1a1a !important;
        }
        .alerta-100x-content{
            display:flex;align-items:center;justify-content:center;width:100%;z-index:2;
            white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative;
        }
        .alerta-100x-content .info-icon{
            margin-left:8px;font-style:italic;font-weight:bold;font-size:12px;opacity:.8;
        }

        /* RADAR VERMELHO CENTRAL – 60px GROSSO */
        .alerta-100x-radar{
            position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
            width:60px;height:60px;border-radius:50%;overflow:hidden;pointer-events:none;
            z-index:1;
        }
        .radar-circle{
            position:absolute;width:100%;height:100%;
            border:3.5px solid rgba(255,0,0,.6);border-radius:50%;
            animation:radarPulse 2s infinite;
        }
        .radar-circle:nth-child(2){animation-delay:.5s;opacity:.7;}
        .radar-circle:nth-child(3){animation-delay:1s;opacity:.4;}
        .radar-scan{
            position:absolute;top:50%;left:50%;width:4px;height:50%;
            background:linear-gradient(to top,transparent,#ff3333);
            transform-origin:bottom;animation:radarScan 3s linear infinite;
        }
        @keyframes radarPulse{
            0%{transform:scale(.6);opacity:1;}
            100%{transform:scale(1.8);opacity:0;}
        }
        @keyframes radarScan{to{transform:rotate(360deg);}}

        .historico-100x-popup{
            position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
            background:#2e2e2e;color:#fff;padding:20px;border-radius:14px;
            box-shadow:0 4px 15px rgba(0,0,0,.8);z-index:2000;text-align:center;
        }
    </style>
</head>
<body>
    <div class="dashboard-container" id="dashboard-container">
        <div class="sidebar">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.21 6.63h6.95l-5.63 4.09 2.21 6.63-5.63-4.09-5.63 4.09 2.21-6.63-5.63-4.09h6.95z"/></svg>
                <span>Dashboard</span>
            </div>
            <div class="menu-item active">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:12px;"><path d="M3 3v18h18"/><path d="M18.7 8.7L12 15.4 9.3 12.7 5.7 16.3"/></svg>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="window.location.href='planilha.html'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:12px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                <span>Planilha</span>
            </div>
            <div class="menu-item" onclick="window.location.href='bot2x.html'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:12px;"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                <span>Bot2x</span>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-left-content">
                    <h2>Dashboard</h2>
                    <button id="logout-button" class="logout-button" onclick="window.logout()">Sair</button>
                </div>
                <input type="date" id="date-filter" class="date-filter-input" onchange="renderDashboard()"/>
                <div class="user-profile">
                    <img src="https://i.postimg.cc/q7nqXJTq/logo-GOATH.png" alt="Logo GOATH" class="user-logo"/>
                    goathbet
                </div>
            </div>

            <!-- CARD SLIM 100x -->
            <div id="alerta-100x-card" class="alerta-100x-card" title="Clique para ver o último 100x+"
                 onclick="openSlidebar('alert-100x-slidebar')">
                <div class="alerta-100x-content">
                    <span id="alerta-100x-texto">⚠️ possível 100x às --:--</span>
                    <span class="info-icon">i</span>
                </div>

                <!-- RADAR VERMELHO CENTRAL -->
                <div class="alerta-100x-radar">
                    <div class="radar-circle"></div>
                    <div class="radar-circle"></div>
                    <div class="radar-circle"></div>
                    <div class="radar-scan"></div>
                </div>
            </div>

            <div id="historico-100x" class="historico-100x-popup" style="display:none;">
                <p id="historico-texto"></p>
            </div>

            <!-- CARDS PRINCIPAIS -->
            <div class="stats-cards">
                <div class="card" id="prob-10x-card" onclick="openSlidebar('prob-10x-slidebar')">
                    <div class="card-label">Probabilidade 10x</div>
                    <div class="card-value" id="prob-10x" data-value="20">20%</div>
                    <span class="info-icon">i</span>
                </div>

                <div class="card" id="prob-50x-card" onclick="openSlidebar('prob-50x-slidebar')">
                    <div class="card-label">Probabilidade 50x</div>
                    <div class="card-value" id="prob-50x" data-value="20">20%</div>
                    <span class="info-icon">i</span>
                </div>

                <div class="card" id="time-pattern-card" onclick="openSlidebar('time-pattern-slidebar')">
                    <div class="card-label">Padrão de Tempo Rosa</div>
                    <div class="card-value" id="time-pattern-status">Aguardando</div>
                    <span class="info-icon">i</span>
                </div>
            </div>

            <!-- Gatilhos & Condições -->
            <div class="strong-entry-container">
                <div class="entry-card trigger-card-button" id="trigger-card-pink" onclick="openSlidebar('pink-triggers-slidebar')">
                    Gatilhos de Rosa
                    <span class="info-icon">i</span>
                </div>

                <div class="entry-card entry-conditions">
                    <h4>Condições para Entrada Forte:</h4>
                    <ul class="condition-list" id="condition-list">
                        <li class="condition-item" id="cond-prob">Probabilidade Alta (≥75% / ≥70%)</li>
                        <li class="condition-item" id="cond-pattern">Padrão Forte Ativo (≥3 reps)</li>
                        <li class="condition-item" id="cond-time50x">Tempo sem 50x (≥ Média)</li>
                        <li class="condition-item" id="cond-positive-pred">Predominância de Positivas (≥2.00x)</li>
                    </ul>
                </div>

                <div class="entry-card trigger-card-button" id="trigger-card-5x" onclick="openSlidebar('prob-5x-slidebar')">
                    Chance de 5x
                    <span class="info-icon">i</span>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="color-filter">
                    <div class="filter-label">Filtrar Cores:</div>
                    <div class="filter-checkbox-group">
                        <input type="checkbox" id="filter-blue" class="filter-checkbox" checked onchange="renderDashboard()"/>
                        <label for="filter-blue" class="filter-button">Azul</label>

                        <input type="checkbox" id="filter-purple" class="filter-checkbox" checked onchange="renderDashboard()"/>
                        <label for="filter-purple" class="filter-button">Roxo</label>

                        <input type="checkbox" id="filter-pink" class="filter-checkbox" checked onchange="renderDashboard()"/>
                        <label for="filter-pink" class="filter-button">Rosa</label>
                    </div>
                </div>

                <div class="columns-filter">
                    <div class="columns-label">Quantidade de Colunas:</div>
                    <select id="columns-select" class="columns-select" onchange="updateGridColumns()">
                        <option value="3">3</option><option value="4">4</option><option value="5">5</option>
                        <option value="6">6</option><option value="7">7</option><option value="8">8</option>
                        <option value="9">9</option><option value="10">10</option><option value="11">11</option>
                        <option value="12">12</option><option value="13">13</option><option value="14">14</option>
                        <option value="15">15</option>
                    </select>
                </div>
            </div>

            <!-- Médias -->
            <div class="averages-section">
                <div class="card">
                    <div class="card-label">Média azul</div>
                    <div class="card-value blue">1.10x</div>
                </div>
                <div class="card">
                    <div class="card-label">Média Roxa</div>
                    <div class="card-value purple">2.00x</div>
                </div>
                <div class="card">
                    <div class="card-label">Média Rosa</div>
                    <div class="card-value pink">10.00x</div>
                </div>
            </div>

            <h3>Gráfico Atual em tempo real</h3>
            <div class="multiplier-grid" id="multiplier-grid">
                <div style="grid-column:1/-1;text-align:center;padding:50px;color:var(--cor-texto-suave);">
                  Aguardando dados do bot...
                </div>
            </div>
        </div>
    </div>

    <!-- Slidebars -->
    <div id="prob-10x-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('prob-10x-slidebar')">×</button>
        <div class="slidebar-title">Probabilidade 10x</div>
        <div class="slidebar-content">
            <p>A probabilidade 10x calcula a chance de uma vela rosa (≥10x) baseada em padrões de tempo, repetições de intervalos e multiplicadores gatilho.</p>
            <h4>Repetições de Intervalos entre Rosas (Tempo):</h4>
            <ul id="interval-list-10x" class="interval-list"></ul>
        </div>
    </div>

    <div id="prob-50x-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('prob-50x-slidebar')">×</button>
        <div class="slidebar-title">Probabilidade 50x</div>
        <div class="slidebar-content">
            <p>A probabilidade 50x calcula a chance de uma vela ≥50x baseada na contagem de velas rosas inferiores a certos limites, reiniciando após uma ≥50x.</p>
            <h4>Informações:</h4>
            <div class="info-card" id="pink-below-50x"></div>
            <div class="info-card" id="pink-below-35x"></div>
            <div class="info-card" id="time-since-last-50x"></div>
            <div class="info-card" id="average-time-between-50x"></div>
        </div>
    </div>

    <div id="pink-triggers-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('pink-triggers-slidebar')">×</button>
        <div class="slidebar-title">Gatilhos de Rosa</div>
        <div class="slidebar-content">
            <ul id="pink-triggers-list">
                <li class="list-header">Últimos multiplicadores que puxaram velas rosas nas últimas 2 horas:</li>
            </ul>
        </div>
    </div>

    <div id="prob-5x-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('prob-5x-slidebar')">×</button>
        <div class="slidebar-title">Chance de 5x</div>
        <div class="slidebar-content">
            <p>Informações sobre velas de 5.00x ou mais, chance de 5x após 3 e 5 minutos além do intervalo entre o penúltimo e último 5x.</p>
            <h4>Informações:</h4>
            <div class="info-card" id="time-since-last-5x"></div>
            <div class="info-card" id="average-time-between-5x"></div>
        </div>
    </div>

    <div id="time-pattern-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('time-pattern-slidebar')">×</button>
        <div class="slidebar-title">Padrão de Tempo Rosa</div>
        <div class="slidebar-content">
            <p>Calcula o próximo horário provável para uma vela rosa com base em intervalos fixos (3, 5, 7, e 10 minutos) após a última vela rosa.</p>
            <h4>Padrão Atual:</h4>
            <div class="info-card" id="time-pattern-details">Nenhum padrão ativo.</div>
        </div>
    </div>

    <!-- SLIDEBAR 100x – TEXTOS CORRIGIDOS -->
    <div id="alert-100x-slidebar" class="slidebar">
        <button class="slidebar-close" onclick="closeSlidebar('alert-100x-slidebar')">×</button>
        <div class="slidebar-title">Informações 100x</div>
        <div class="slidebar-content">

            <!-- ÚLTIMA VELA ≥100x -->
            <div class="info-card" id="alert-100x-last">
                Última rosa 100x: Nenhuma
            </div>

            <!-- TEMPO SEM 100x -->
            <div class="info-card" id="tempo-100x-card" style="margin-top:12px; background:#2c3e50; color:#fff;">
                <strong>tempo sem 100x:</strong> <span id="tempo-100x-value">-- minutos</span>
            </div>

           <h4 style="margin-top:16px;">Histórico das últimas 7 velas de 100x:</h4>
<div class="info-card" id="alert-100x-next1">--</div>
<div class="info-card" id="alert-100x-next2">--</div>
<div class="info-card" id="alert-100x-next3">--</div>
<div class="info-card" id="alert-100x-next4">--</div>
<div class="info-card" id="alert-100x-next5">--</div>
<div class="info-card" id="alert-100x-next6">--</div>
<div class="info-card" id="alert-100x-next7">--</div>

            <!-- ÚLTIMO INTERVALO -->
            <h4 style="margin-top:16px;">Último intervalo entre 100x</h4>
            <div class="info-card" id="interval-100x-info">
                Último intervalo: -- minutos
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>

    <!-- Anti-DevTools -->
    <script>
      (function antiDevTools(){
        const redirectURL="/";
        document.addEventListener("keydown",e=>{
          if(e.key==="F12"||(e.ctrlKey&&e.shiftKey&&["I","i","J","j","C","c"].includes(e.key))){
            e.preventDefault();window.location.replace(redirectURL);
          }
        });
        document.addEventListener("contextmenu",e=>e.preventDefault());
        const element=new Image();
        Object.defineProperty(element,"id",{get:()=> {throw new Error("DevTools detectado!");}});
        setInterval(()=>{console.log(element);},1000);
      })();
    </script>
</body>

</html>
