<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aviator Smart Signals</title>

<script>
    const API_BASE = "https://keysdash.espanhaserrita.workers.dev/";

    async function verificarSessao() {
      const token = sessionStorage.getItem("sessionId");
      if (!token) {
        window.location.href = "/";
        return;
      }

      try {
        const res = await fetch(API_BASE + "verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token }),
        });
        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          window.location.href = "/";
        }
      } catch (err) {
        console.error("Erro ao validar sessão:", err);
        window.location.href = "/";
      }
    }

    verificarSessao();
  </script>

  <link rel="stylesheet" href="botstyles.css" />

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script defer src="botscript.js"></script>
</head>
<body>
<header>
  <div class="header-left">
    <a href="dashboard.html" class="back-btn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.707 10.707a1 1 0 0 1-1.414 0L12 9.414l-3.293 3.293a1 1 0 0 1-1.414-1.414l4-4a1 1 0 0 1 1.414 0l4 4a1 1 0 0 1 0 1.414z"/></svg>
      Voltar
    </a>
    <div class="brand">
      <img src="https://i.postimg.cc/yYzNXKqx/Picsart-25-10-27-10-15-31-195.png" alt="Logo" class="logo-img">
      <h1>Aviator Smart Signals</h1>
    </div>
  </div>
  <div class="status-badge" id="liveStatus">Conectando ao Firebase…</div>
</header>

<main>
  <div class="grid">

    <div class="sinais-feed-container">
        <section class="card signal-card" id="chanceCardParent">
            <div class="chance-card" id="chanceCard">
                <div class="chance-title" id="chanceTitle">Chance de 2x</div>
                <div class="chance-sub" id="chanceSub">identificando padrão…</div>
                <div class="sep"></div>
                <div class="row">
                    <span class="pill" id="strategyTag">Estratégia: —</span>
                    <span class="pill" id="gateTag">Gatilho: —</span>
                    <span class="pill" id="martingaleTag" style="display:none;">G1/G2</span>
                </div>
            </div>
        </section>

        <section class="card feed-card-parent">
            <div class="stats-header">Feed de Sinais</div>
            <div class="feed" id="feed"></div>
        </section>
    </div>
    
    <section class="card stats-card-parent">
      <div class="stats-header">Estatísticas desde que você entrou:</div>
      
      <div class="stats-kpi-grid">
        <div class="kpi-box" id="engineStatus-kpi">
          <div class="label">Status</div>
          <div class="big" id="engineStatus">Inicializando…</div>
        </div>
        <div class="kpi-box" id="predStatus-kpi">
          <div class="label">Predominância:</div>
          <div class="big" id="predStatus">—</div>
        </div>
        <div class="kpi-box" id="blueRun-kpi">
          <div class="label">Azuis Seguidas:</div>
          <div class="big" id="blueRun">0</div>
        </div>
      </div>

      <div class="stats-kpi-grid">
        <div class="kpi-box">
          <div class="label">Acertos Consecutivos</div>
          <div class="big" id="streak">0</div>
          <button class="btn-more" id="streakMoreBtn">detalhes</button>
        </div>
        <div class="kpi-box">
          <div class="label">Total Acertos</div>
          <div class="big" id="wins">0</div>
          <button class="btn-more" id="winsMoreBtn">detalhes</button>
        </div>
        <div class="kpi-box">
          <div class="label">Total Erros</div>
          <div class="big" id="losses">0</div>
        </div>
      </div>

      <button class="btn-clear-stats" id="clearStatsBtn">LIMPAR TUDO</button>
    </section>

    <section class="card history-card-parent">
      <div class="stats-header">Últimas 24 velas</div>
      <div id="history" class="history"></div>
    </section>

  </div>
</main>

<div class="topslide" id="topslide"></div>

<div class="sidebar" id="winsSidebar">
  <div class="sidebar-header">
    <h3>Detalhes de Acertos</h3>
    <button class="close-btn" id="closeWins">×</button>
  </div>
  <div class="stat-line"><span>Acertos normais</span><strong id="normalWins">0</strong></div>
  <div class="stat-line"><span>Acertos G1</span><strong id="g1Wins">0</strong></div>
  <div class="stat-line"><span>Acertos G2</span><strong id="g2Wins">0</strong></div>
</div>

<div class="sidebar" id="streakSidebar">
  <div class="sidebar-header">
    <h3>Maior Sequência</h3>
    <button class="close-btn" id="closeStreak">×</button>
  </div>
  <div class="stat-line"><span>Maior sequência</span><strong id="maxStreak">0</strong></div>
</div>
<script>
  (function antiDevTools() {
    const redirectURL = "/"; // volta pro login

    document.addEventListener("keydown", (e) => {
      if (
        e.key === "F12" ||
        (e.ctrlKey && e.shiftKey && ["I","i","J","j","C","c"].includes(e.key))
      ) {
        e.preventDefault();
        window.location.replace(redirectURL);
      }
    });

    document.addEventListener("contextmenu", (e) => e.preventDefault());

    const element = new Image();
    Object.defineProperty(element, "id", {
      get: function () {
        throw new Error("DevTools detectado!");
      },
    });

    setInterval(() => {
      console.log(element);
    }, 1000);
  })();
</script>
</body>
</html>
